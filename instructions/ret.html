<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Instrução RET - RV32IM</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500&family=Fira+Code&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <a href="../risc-v-assembly-pt.html" class="back-link">← Voltar para Referência</a>

        <h1>RET - Retorno de Função (Return)</h1>

        <h2>Sintaxe</h2>
        <div class="syntax-box">ret</div>

        <h2>Descrição</h2>
        <p>Salta para o endereço armazenado no registrador de retorno (<code>ra</code> ou <code>x1</code>). Esta é uma pseudo-instrução que é traduzida para <code>jalr x0, ra, 0</code>. Usada ao final de funções para retornar ao ponto de chamada.</p>

        <h2>Formato e Codificação</h2>
        <div class="info-grid">
            <div class="info-item"><strong>Formato:</strong> Pseudo-instrução (I-type)</div>
            <div class="info-item"><strong>Tradução:</strong> <code>jalr x0, x1, 0</code></div>
            <div class="info-item"><strong>Opcode:</strong> <code>1100111</code></div>
            <div class="info-item"><strong>funct3:</strong> <code>0x0</code></div>
        </div>

        <h2>Operação</h2>
        <div class="syntax-box">PC = ra</div>

        <h2>Exemplos de Uso</h2>

        <div class="example-section">
            <h3>Exemplo 1: Função simples (leaf function)</h3>
            <div class="example-code">soma_cinco:
    addi x10, x10, 5
    ret               # retorna ao chamador

main:
    li x10, 10
    jal soma_cinco    # chama função
    # x10 agora contém 15</div>
            <div class="example-explanation">
                Função folha (leaf function) que não chama outras funções, então não precisa salvar ra na pilha.
            </div>
        </div>

        <div class="example-section">
            <h3>Exemplo 2: Função com chamadas internas (non-leaf)</h3>
            <div class="example-code">funcao_externa:
    addi sp, sp, -4
    sw ra, 0(sp)      # salva ra na pilha

    jal funcao_1      # chama primeira função
    jal funcao_2      # chama segunda função

    lw ra, 0(sp)      # restaura ra
    addi sp, sp, 4
    ret               # retorna ao chamador original</div>
            <div class="example-explanation">
                Função não-folha que chama outras funções deve salvar e restaurar ra para preservar o endereço de retorno original.
            </div>
        </div>

        <div class="example-section">
            <h3>Exemplo 3: Retorno condicional</h3>
            <div class="example-code">verifica_positivo:
    bgtz x10, eh_positivo
    li x10, 0         # retorna 0 se negativo
    ret

eh_positivo:
    li x10, 1         # retorna 1 se positivo
    ret</div>
            <div class="example-explanation">
                Função pode ter múltiplos pontos de retorno dependendo da lógica condicional.
            </div>
        </div>

        <h2>Observações</h2>
        <ul class="notes-list">
            <li>Esta é uma pseudo-instrução expandida para <code>jalr x0, x1, 0</code></li>
            <li>Sempre usa o registrador ra (x1) como fonte do endereço de retorno</li>
            <li>Não salva novo endereço de retorno (usa x0 como destino)</li>
            <li>Deve ser precedido por <code>jal</code> que salvou o endereço em ra</li>
            <li>Em funções não-folha, ra deve ser salvo/restaurado da pilha</li>
            <li>Convenção ABI: ra é caller-saved, deve ser preservado se função chama outras</li>
            <li>É a forma mais legível e idiomática de retornar de funções</li>
            <li>Equivalente funcional: <code>jalr x0, ra, 0</code> ou <code>jr ra</code></li>
        </ul>
    </div>
</body>
</html>
