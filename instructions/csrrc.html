<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Instrução CSRRC - RV32IM</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500&family=Fira+Code&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <a href="../index.html" class="back-link">← Voltar para Referência</a>

        <h1>CSRRC - Leitura e Clear Atômico de Bits em CSR</h1>

        <h2>Sintaxe</h2>
        <div class="syntax-box">csrrc rd, csr, rs1</div>

        <h2>Descrição</h2>
        <p>Executa uma operação atômica de leitura-modificação-escrita. Lê o valor do registrador de controle e status (CSR) <code>csr</code>, o estende com zeros e o armazena em <code>rd</code>. O valor antigo do CSR é então atualizado fazendo uma operação AND com o valor invertido de <code>rs1</code>. Isso efetivamente "limpa" (desliga) os bits no CSR que estão ligados em <code>rs1</code>.</p>

        <h2>Formato e Codificação</h2>
        <div class="info-grid">
            <div class="info-item"><strong>Formato:</strong> I-type (System)</div>
            <div class="info-item"><strong>Opcode:</strong> <code>1110011</code></div>
            <div class="info-item"><strong>funct3:</strong> <code>0x3</code></div>
        </div>

        <h2>Operação</h2>
        <div class="syntax-box">temp = csr
csr = temp & ~rs1
rd = temp</div>

        <h2>Exemplos de Uso</h2>

        <div class="example-section">
            <h3>Exemplo 1: Desabilitar interrupções e ler estado anterior</h3>
            <div class="example-code"># Desabilitar o bit de interrupção global (MIE, bit 3) no 'mstatus'
li t0, 1 << 3
csrrc t1, mstatus, t0  # t1 = valor antigo de mstatus, mstatus agora tem o bit MIE desligado</div>
            <div class="example-explanation">
                Esta operação desabilita atomicamente as interrupções globais e salva o estado anterior de `mstatus` em `t1`, permitindo que seja restaurado depois.
            </div>
        </div>

        <div class="example-section">
            <h3>Exemplo 2: Implementando `csrc` (pseudo-instrução)</h3>
            <div class="example-code"># A pseudo-instrução 'csrc csr, rs' (clear bits) é implementada como:
csrrc x0, csr, rs</div>
            <div class="example-explanation">
                Quando `rd` é `x0`, o valor original do CSR é lido mas descartado. A instrução efetivamente apenas limpa os bits especificados por `rs` no CSR.
            </div>
        </div>

        <h2>Observações</h2>
        <ul class="notes-list">
            <li>Se `rs1` for `x0`, a instrução não escreve no CSR e atua como uma leitura pura (idêntico a `csrrs rd, csr, x0`).</li>
            <li>Se `rd` for `x0`, o valor lido do CSR é descartado, e a instrução atua como uma escrita "clear-only". Isso forma a base da pseudo-instrução `csrc`.</li>
            <li>A operação é atômica.</li>
        </ul>
    </div>
</body>
</html>
